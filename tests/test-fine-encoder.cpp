#include "bark.h"

#include <cstdio>
#include <string>
#include <map>
#include <random>
#include <vector>

static const std::map<bark_codes, bark_codes> & k_tests()
{
    static const bark_codes seq1 = {
        { 62, 121, 62, 635, 635, 537, 676, 635, 537, 208, 676, 676, 635, 879, 676, 635, 635, 208, 676, 635, 635, 819, 676, 635, 635, 676, 676, 635, 635, 879, 676, 676, 635, 676, 676, 635, 635, 676, 676, 635, 635, 208, 676, 635, 635, 676, 676, 635, 635, 676, 753, 635, 635, 860, 676, 635, 635, 208, 676, 635, 635, 860, 676, 635, 635, 676, 676, 635, 635, 777, 676, 635, 635, 208, 676, 635, 635, 676, 676, 635, 635, 777, 676, 635, 635, 676, 676, 635, 635, 676, 676, 635, 635, 676, 676, 635, 635, 777, 676, 635, 635, 676, 676, 635, 635, 676, 676, 635, 635, 676, 676, 635, 635, 676, 676, 635, 635, 777, 676, 635, 635, 676, 676, 635, 635, 777, 676, 635, 635, 777, 676, 635, 635, 676, 676, 635, 635, 676, 676, 635, 635, 777, 676, 635, 635, 777, 676, 635, 635, 676, 676, 635, 635, 676, 676, 635, 635, 676, 676, 635, 635, 676, 676, 635, 635, 676, 676, 635, 635, 676, 676, 635, 635, 777, 676, 635, 635, 676, 676, 635, 635, 676, 676, 635, 635, 676, 676, 635, 635, 777, 676, 635, 635, 676, 676, 635, 635, 676, 676, 635, 635, 676, 676, 635, 635, 676, 676, 635, 635, 777, 676, 635, 635, 777, 676, 635, 635, 676, 676, 635, 635, 676, 676, 635, 635, 676, 676, 635, 635, 676, 676 },
        { 913, 424, 424, 894, 980, 964, 458, 994, 516, 200, 516, 959, 458, 687, 894, 959, 516, 200, 516, 176, 458, 964, 894, 496, 516, 687, 516, 176, 743, 462, 894, 897, 516, 687, 673, 176, 743, 777, 516, 811, 516, 200, 488, 964, 743, 571, 894, 897, 516, 687, 896, 964, 743, 200, 531, 897, 516, 200, 896, 964, 743, 802, 531, 897, 516, 687, 896, 964, 743, 673, 894, 811, 516, 200, 896, 964, 743, 673, 894, 897, 516, 820, 896, 176, 743, 673, 894, 811, 516, 687, 896, 176, 743, 462, 894, 687, 516, 820, 896, 176, 743, 462, 894, 811, 516, 687, 896, 888, 743, 462, 894, 687, 516, 687, 896, 964, 743, 673, 894, 897, 516, 894, 896, 964, 743, 673, 894, 687, 516, 820, 896, 964, 743, 462, 894, 897, 516, 687, 896, 687, 743, 673, 894, 687, 516, 820, 896, 964, 743, 462, 894, 897, 516, 687, 896, 964, 743, 673, 894, 687, 516, 826, 896, 964, 743, 462, 894, 687, 516, 687, 896, 964, 743, 673, 894, 897, 516, 826, 896, 964, 743, 462, 894, 897, 516, 777, 896, 964, 743, 673, 894, 897, 516, 826, 896, 964, 743, 673, 894, 897, 516, 894, 896, 964, 743, 462, 894, 897, 516, 820, 896, 176, 743, 673, 894, 897, 516, 687, 896, 964, 743, 462, 894, 687, 516, 687, 896, 964, 743, 462, 894 }
    };
    static const bark_codes seq2 = {
        { 160,  160,  160,  160,  176,   25,  958,  782,  588,  612,  540, 540,  961,  833,  833,  833,  833,  833,  871,  676,  360,  360, 360,  160,  160,  160,  160,  160,  160,  709,  339,  835,  835, 835,  835,  835,  408,   62,  408,   62,   62,  408,  717,   62, 717,  717,  372,  951,  961,  982,  699,  753,  879,  224,  192, 372,  106,  855,  106,  106,  408,  393,  257,  128,  203,  203, 203,  747,  747,  747,  747,  233,  372,  192,  325,  753,  879, 906,  598,  598,  151,  151,  151,  151,  540,  192,  317,  961, 414,  582,  192,  192,  747,  275,   11,   11,   11,   11,  291, 185,  155,  155,   30,  871,  699,  604,  432,  604,  432, 1019, 738,  408,  408,  408,  408,   62,   62,  408,   62,   62,   62, 62,   62,  717,   62,   62,   62,   62,   62,  717,   62,   62, 62,   62,   62,   62,   62,   62,   62,   62,   62,   62,   62, 62,   62,   62,   62,   62,   62,   62,   62,   62,   62,   62, 62,   62,   62,   62,   62,   62,   62,   62,   62,   62,   62, 62,   62,   62,   62,   62,   62 },
        { 348,  348,  348,  348,  646,  747,  580,  367,  367,  268,  460, 268,  991,  268,  268,  268,  460,  367,  317,  726,  161,  201, 129,  926,  926,  646,  348,  646,  646,  857,  857,  518,  913, 913,  913,  913,  518,  424,  913,  424,  424,  913,  424,  424, 424,  424,  860,  347,  347,  347,  987,  601,  998,  228,  367, 347,  580,  580,  928,  913,  424,  497,  984,  216,  233,  751, 736,  621,   33,   15,  515,  194,  834,  995,  870,  829,  964, 565,  565,  517,  868,  666,   16,  943,  529,  560,   45,   52, 268,   43,  484,  584,  834, 1014,  459,  371,  584,  864,  871, 45,  467,  214,  167,  350,  964,  928,  765,  266,  601,  404, 601,  404,  700,  518,  518,  424,  424,  913,  424,  424,  424, 424,  518,  518,  518,  518,  518,  518,  518,  518,  518,  518, 518,  518,  518,  518,  518,  518,  518,  518,  518,  518,  518, 518,  518,  518,  518,  518,  518,  518,  518,  518,  518,  518, 518,  518,  518,  518,  518,  518,  518,  518,  518,  518,  518, 518,  518,  518,  518,  518,  518},
    };
    static const bark_codes seq3 = {
        { 871, 971, 871, 971, 871, 971, 971, 871, 971, 871, 971, 871, 971, 871, 635, 151, 533, 862, 415, 415, 862, 833, 1008, 881, 457, 942, 936, 751, 967, 879, 971, 347, 971, 871, 461, 940, 940, 151, 666, 800, 1018, 683, 912, 457, 833, 967, 1008, 501, 112, 923, 747, 747, 240, 690, 976, 347, 370, 370, 370, 934, 934, 934, 373, 373, 373, 373, 373, 373, 798, 935, 192, 233, 291, 192, 185, 679, 613, 613, 155, 901, 901, 901, 901, 598, 325, 904, 370, 904, 971, 370, 935, 496, 935, 666, 666, 982, 411, 59, 23, 23, 23, 604, 753, 370, 879, 91, 819, 798, 798, 798, 73, 91, 358, 11, 683, 901, 1022, 875, 321, 1001, 224, 1001, 982, 59, 151, 151, 1001, 151, 151, 151, 276, 208, 904, 904, 904, 904, 904, 904, 904, 276, 479, 59, 59, 59, 982, 982, 879, 699, 491, 151, 906, 151, 151, 598, 321, 699, 604, 604, 395, 904, 904, 904, 819, 887, 192, 59, 59, 59, 59, 59, 611 },
        { 969, 829, 969, 969, 969, 770, 666, 359, 969, 969, 969, 646, 969, 969, 71, 827, 185, 588, 878, 303, 987, 296, 666, 405, 373, 213, 729, 729, 729, 359, 729, 729, 729, 729, 164, 37, 144, 833, 770, 182, 212, 269, 228, 920, 564, 564, 199, 891, 891, 598, 36, 836, 959, 836, 633, 501, 687, 601, 857, 221, 633, 501, 747, 747, 747, 747, 747, 747, 752, 765, 947, 690, 955, 741, 406, 414, 654, 654, 907, 872, 654, 1002, 269, 632, 646, 877, 743, 829, 601, 404, 404, 857, 144, 501, 998, 767, 589, 924, 241, 439, 708, 877, 212, 765, 633, 928, 200, 404, 765, 601, 633, 404, 573, 175, 37, 800, 820, 897, 67, 693, 462, 520, 60, 176, 897, 578, 904, 458, 673, 596, 772, 772, 404, 71, 601, 601, 404, 404, 765, 928, 702, 283, 812, 560, 422, 63, 894, 71, 743, 229, 446, 998, 4, 904, 446, 772, 603, 829, 363, 404, 747, 601, 646, 404, 947, 178, 831, 831, 430, 793, 446 }
    };

    static const bark_codes ans1 = {
        { 62, 121, 62, 635, 635, 537, 676, 635, 537, 208, 676, 676, 635, 879, 676, 635, 635, 208, 676, 635, 635, 819, 676, 635, 635, 676, 676, 635, 635, 879, 676, 676, 635, 676, 676, 635, 635, 676, 676, 635, 635, 208, 676, 635, 635, 676, 676, 635, 635, 676, 753, 635, 635, 860, 676, 635, 635, 208, 676, 635, 635, 860, 676, 635, 635, 676, 676, 635, 635, 777, 676, 635, 635, 208, 676, 635, 635, 676, 676, 635, 635, 777, 676, 635, 635, 676, 676, 635, 635, 676, 676, 635, 635, 676, 676, 635, 635, 777, 676, 635, 635, 676, 676, 635, 635, 676, 676, 635, 635, 676, 676, 635, 635, 676, 676, 635, 635, 777, 676, 635, 635, 676, 676, 635, 635, 777, 676, 635, 635, 777, 676, 635, 635, 676, 676, 635, 635, 676, 676, 635, 635, 777, 676, 635, 635, 777, 676, 635, 635, 676, 676, 635, 635, 676, 676, 635, 635, 676, 676, 635, 635, 676, 676, 635, 635, 676, 676, 635, 635, 676, 676, 635, 635, 777, 676, 635, 635, 676, 676, 635, 635, 676, 676, 635, 635, 676, 676, 635, 635, 777, 676, 635, 635, 676, 676, 635, 635, 676, 676, 635, 635, 676, 676, 635, 635, 676, 676, 635, 635, 777, 676, 635, 635, 777, 676, 635, 635, 676, 676, 635, 635, 676, 676, 635, 635, 676, 676, 635, 635, 676, 676 },
        { 913, 424, 424, 894, 980, 964, 458, 994, 516, 200, 516, 959, 458, 687, 894, 959, 516, 200, 516, 176, 458, 964, 894, 496, 516, 687, 516, 176, 743, 462, 894, 897, 516, 687, 673, 176, 743, 777, 516, 811, 516, 200, 488, 964, 743, 571, 894, 897, 516, 687, 896, 964, 743, 200, 531, 897, 516, 200, 896, 964, 743, 802, 531, 897, 516, 687, 896, 964, 743, 673, 894, 811, 516, 200, 896, 964, 743, 673, 894, 897, 516, 820, 896, 176, 743, 673, 894, 811, 516, 687, 896, 176, 743, 462, 894, 687, 516, 820, 896, 176, 743, 462, 894, 811, 516, 687, 896, 888, 743, 462, 894, 687, 516, 687, 896, 964, 743, 673, 894, 897, 516, 894, 896, 964, 743, 673, 894, 687, 516, 820, 896, 964, 743, 462, 894, 897, 516, 687, 896, 687, 743, 673, 894, 687, 516, 820, 896, 964, 743, 462, 894, 897, 516, 687, 896, 964, 743, 673, 894, 687, 516, 826, 896, 964, 743, 462, 894, 687, 516, 687, 896, 964, 743, 673, 894, 897, 516, 826, 896, 964, 743, 462, 894, 897, 516, 777, 896, 964, 743, 673, 894, 897, 516, 826, 896, 964, 743, 673, 894, 897, 516, 894, 896, 964, 743, 462, 894, 897, 516, 820, 896, 176, 743, 673, 894, 897, 516, 687, 896, 964, 743, 462, 894, 687, 516, 687, 896, 964, 743, 462, 894 },
        { 786, 36, 786, 819, 710, 767, 39, 880, 894, 879, 752, 238, 1007, 675, 126, 879, 1007, 710, 675, 933, 982, 767, 982, 880, 861, 863, 878, 818, 126, 255, 982, 253, 861, 238, 692, 880, 126, 675, 39, 893, 967, 710, 982, 819, 126, 675, 982, 936, 967, 863, 414, 1000, 126, 767, 936, 936, 675, 710, 815, 829, 752, 710, 856, 936, 967, 1007, 1007, 670, 126, 937, 982, 711, 675, 846, 818, 967, 752, 767, 982, 1000, 675, 861, 1007, 1016, 752, 767, 982, 1015, 675, 863, 1007, 1016, 126, 829, 982, 604, 861, 829, 1007, 1016, 126, 829, 982, 653, 861, 863, 1007, 253, 126, 936, 982, 604, 967, 1007, 815, 705, 126, 414, 982, 752, 967, 829, 815, 967, 752, 937, 982, 604, 675, 861, 692, 818, 752, 936, 982, 967, 675, 1007, 982, 39, 752, 414, 982, 604, 675, 861, 815, 819, 863, 365, 982, 936, 675, 863, 692, 458, 710, 767, 982, 604, 967, 936, 815, 967, 647, 936, 797, 967, 790, 1007, 815, 967, 752, 414, 982, 936, 675, 38, 982, 967, 982, 970, 982, 936, 675, 863, 705, 967, 863, 829, 982, 819, 675, 38, 818, 967, 126, 767, 8, 967, 675, 767, 893, 818, 710, 837, 982, 752, 675, 861, 1007, 818, 126, 863, 982, 936, 675, 863, 1007, 967, 126, 710, 982, 604, 861, 1007, 432, 863, 710, 837, 8 },
        { 673, 673, 673, 830, 933, 983, 854, 714, 859, 983, 933, 674, 854, 854, 74, 104, 1014, 854, 1022, 776, 854, 364, 962, 757, 1014, 388, 714, 830, 714, 830, 762, 364, 288, 956, 866, 104, 993, 364, 859, 922, 734, 670, 734, 830, 74, 714, 734, 830, 734, 388, 962, 859, 74, 1014, 962, 830, 36, 670, 854, 558, 558, 962, 733, 830, 714, 315, 962, 838, 74, 859, 734, 859, 36, 945, 962, 859, 866, 983, 734, 1022, 36, 1022, 962, 830, 962, 983, 762, 922, 36, 388, 962, 830, 74, 388, 854, 859, 288, 714, 931, 830, 779, 388, 734, 1022, 916, 388, 962, 74, 74, 388, 734, 859, 714, 315, 838, 830, 74, 859, 734, 830, 779, 859, 838, 830, 558, 831, 734, 859, 487, 835, 962, 830, 962, 487, 762, 830, 36, 859, 962, 104, 962, 859, 734, 859, 36, 835, 854, 558, 962, 388, 734, 1022, 36, 487, 962, 830, 854, 983, 734, 859, 714, 983, 838, 859, 1019, 487, 734, 757, 1016, 315, 854, 830, 962, 859, 734, 288, 36, 859, 962, 830, 1014, 388, 734, 288, 36, 983, 962, 859, 854, 831, 734, 830, 36, 859, 962, 830, 74, 854, 956, 1014, 36, 74, 962, 830, 1014, 388, 734, 830, 36, 793, 838, 830, 239, 831, 734, 104, 36, 388, 962, 830, 74, 779, 915, 859, 779, 859, 962, 830, 1014, 388, 956 },
        { 528, 448, 622, 989, 652, 537, 100, 909, 454, 446, 928, 652, 271, 907, 652, 646, 271, 831, 652, 652, 271, 446, 606, 930, 446, 446, 904, 537, 446, 907, 652, 922, 446, 15, 606, 680, 271, 963, 446, 537, 271, 884, 831, 454, 446, 983, 694, 680, 963, 446, 375, 446, 446, 963, 989, 271, 963, 884, 928, 882, 446, 652, 989, 446, 446, 15, 904, 606, 446, 907, 989, 909, 963, 908, 694, 446, 446, 652, 831, 680, 963, 884, 904, 446, 885, 446, 736, 446, 963, 680, 904, 446, 446, 652, 736, 537, 831, 831, 904, 831, 912, 652, 989, 909, 963, 446, 904, 646, 446, 652, 989, 742, 963, 930, 446, 446, 271, 969, 831, 831, 963, 963, 694, 446, 446, 939, 831, 446, 804, 5, 983, 454, 885, 884, 537, 271, 446, 930, 446, 446, 446, 969, 989, 694, 446, 680, 928, 446, 831, 652, 831, 909, 963, 930, 537, 446, 885, 652, 831, 505, 963, 983, 928, 271, 680, 930, 606, 446, 111, 876, 928, 446, 885, 969, 446, 446, 963, 877, 446, 454, 378, 652, 831, 884, 963, 446, 446, 446, 928, 652, 831, 983, 963, 990, 375, 271, 446, 652, 694, 884, 963, 963, 375, 454, 885, 604, 694, 983, 963, 680, 652, 515, 680, 939, 989, 680, 963, 694, 904, 454, 446, 652, 446, 271, 963, 963, 375, 946, 885, 446, 694 },
        { 1011, 881, 986, 412, 885, 903, 16, 781, 178, 41, 10, 903, 505, 299, 293, 995, 683, 929, 742, 350, 683, 683, 293, 140, 826, 41, 742, 903, 398, 683, 10, 632, 768, 683, 742, 929, 971, 971, 956, 300, 683, 561, 461, 903, 851, 929, 781, 567, 567, 768, 778, 929, 851, 505, 1005, 903, 41, 561, 995, 963, 683, 946, 742, 826, 683, 929, 567, 549, 701, 929, 41, 781, 386, 818, 350, 863, 494, 293, 778, 826, 701, 10, 567, 903, 683, 293, 963, 690, 386, 885, 567, 903, 683, 293, 435, 567, 683, 701, 778, 903, 632, 390, 742, 903, 903, 768, 567, 386, 701, 684, 742, 824, 701, 683, 995, 903, 683, 885, 778, 701, 505, 742, 16, 826, 801, 781, 778, 929, 683, 781, 505, 903, 683, 1011, 546, 546, 683, 683, 956, 946, 683, 885, 742, 824, 683, 863, 995, 929, 561, 1011, 778, 185, 386, 963, 505, 903, 567, 293, 41, 824, 505, 561, 923, 386, 683, 963, 742, 928, 683, 683, 923, 946, 683, 885, 742, 742, 701, 477, 41, 946, 683, 851, 41, 1003, 963, 818, 1005, 863, 683, 963, 778, 903, 701, 293, 350, 386, 971, 632, 995, 701, 683, 567, 963, 903, 293, 19, 781, 903, 701, 602, 778, 923, 632, 768, 742, 929, 611, 768, 567, 929, 683, 975, 742, 742, 505, 1011, 692, 929, 781, 634, 929 },
        { 1002, 900, 1002, 380, 316, 983, 860, 32, 406, 547, 764, 996, 983, 606, 444, 243, 674, 764, 764, 406, 977, 547, 243, 628, 772, 547, 628, 764, 406, 243, 444, 834, 772, 510, 628, 755, 936, 243, 748, 418, 528, 243, 406, 406, 547, 243, 406, 406, 243, 528, 464, 940, 853, 243, 406, 908, 243, 243, 628, 406, 860, 342, 764, 485, 547, 628, 628, 36, 562, 243, 628, 866, 983, 887, 628, 406, 866, 433, 908, 585, 528, 755, 628, 406, 782, 243, 628, 406, 291, 528, 628, 406, 866, 983, 628, 786, 874, 243, 628, 406, 547, 983, 628, 406, 547, 243, 628, 406, 562, 871, 628, 994, 528, 628, 444, 406, 562, 501, 628, 406, 866, 243, 628, 485, 871, 291, 772, 993, 675, 628, 406, 406, 528, 647, 764, 782, 464, 243, 993, 444, 464, 628, 628, 994, 464, 628, 628, 406, 983, 983, 628, 406, 291, 528, 585, 389, 860, 528, 628, 994, 764, 243, 628, 694, 660, 464, 406, 360, 606, 628, 628, 406, 528, 15, 764, 755, 243, 764, 406, 406, 1015, 871, 406, 755, 291, 887, 628, 406, 860, 433, 628, 908, 764, 243, 628, 772, 243, 871, 406, 406, 983, 243, 628, 928, 364, 243, 628, 406, 464, 585, 748, 406, 464, 243, 628, 993, 764, 243, 628, 406, 562, 625, 406, 562, 994, 628, 628, 406, 552, 243, 866 },
        { 899, 518, 948, 173, 416, 173, 622, 383, 989, 700, 988, 851, 639, 343, 931, 931, 628, 931, 416, 138, 416, 937, 700, 416, 42, 937, 639, 931, 845, 416, 322, 416, 1019, 828, 700, 835, 416, 988, 845, 237, 931, 937, 455, 1012, 989, 988, 700, 590, 931, 997, 835, 583, 336, 924, 416, 416, 989, 937, 835, 173, 845, 416, 622, 173, 989, 700, 558, 1019, 1019, 701, 416, 309, 309, 1019, 937, 1012, 568, 701, 233, 660, 845, 701, 701, 937, 416, 1018, 989, 660, 416, 660, 701, 173, 931, 658, 989, 1012, 475, 924, 832, 173, 931, 1019, 135, 693, 416, 246, 701, 1019, 845, 468, 416, 988, 989, 322, 937, 475, 416, 416, 233, 1012, 989, 639, 937, 700, 336, 472, 233, 693, 475, 458, 1012, 965, 617, 835, 1018, 931, 354, 1019, 1012, 558, 701, 416, 937, 737, 828, 416, 835, 1019, 354, 1019, 233, 628, 988, 559, 173, 965, 940, 416, 558, 845, 416, 309, 558, 475, 768, 505, 701, 947, 1019, 937, 107, 835, 336, 534, 768, 828, 989, 354, 845, 416, 416, 658, 1012, 647, 931, 845, 937, 1012, 845, 472, 233, 845, 845, 173, 845, 416, 516, 416, 1019, 845, 1013, 931, 835, 878, 940, 1004, 700, 416, 416, 416, 173, 1013, 416, 937, 135, 1012, 899, 559, 701, 475, 845, 1019, 598, 672, 568, 931, 416, 947, 931, 558, 1019 },
    };
    static const bark_codes ans2 = {
        { 160, 160, 160, 160, 176,  25, 958, 782, 588, 612, 540, 540, 961, 833, 833, 833, 833, 833, 871, 676, 360, 360, 360, 160, 160, 160, 160, 160, 160, 709, 339, 835, 835, 835, 835, 835, 408,  62, 408,  62,  62, 408, 717,  62, 717, 717, 372, 951, 961, 982, 699, 753, 879, 224, 192, 372, 106, 855, 106, 106, 408, 393, 257, 128, 203, 203, 203, 747, 747, 747, 747, 233, 372, 192, 325, 753, 879, 906, 598, 598, 151, 151, 151, 151, 540, 192, 317, 961, 414, 582, 192, 192, 747, 275,  11,  11,  11,  11, 291, 185, 155, 155,  30, 871, 699, 604, 432, 604, 432, 1019, 738, 408, 408, 408, 408,  62,  62, 408,  62,  62,  62, 62,  62, 717,  62,  62,  62,  62,  62, 717,  62,  62, 62,  62,  62,  62,  62,  62,  62,  62,  62,  62,  62, 62,  62,  62,  62,  62,  62,  62,  62,  62,  62,  62, 62,  62,  62,  62,  62,  62,  62,  62,  62,  62,  62, 62,  62,  62,  62,  62,  62 },
        { 348, 348, 348, 348, 646, 747, 580, 367, 367, 268, 460, 268, 991, 268, 268, 268, 460, 367, 317, 726, 161, 201, 129, 926, 926, 646, 348, 646, 646, 857, 857, 518, 913, 913, 913, 913, 518, 424, 913, 424, 424, 913, 424, 424, 424, 424, 860, 347, 347, 347, 987, 601, 998, 228, 367, 347, 580, 580, 928, 913, 424, 497, 984, 216, 233, 751, 736, 621,  33,  15, 515, 194, 834, 995, 870, 829, 964, 565, 565, 517, 868, 666,  16, 943, 529, 560,  45,  52, 268,  43, 484, 584, 834, 1014, 459, 371, 584, 864, 871, 45, 467, 214, 167, 350, 964, 928, 765, 266, 601, 404, 601, 404, 700, 518, 518, 424, 424, 913, 424, 424, 424, 424, 518, 518, 518, 518, 518, 518, 518, 518, 518, 518, 518, 518, 518, 518, 518, 518, 518, 518, 518, 518, 518, 518, 518, 518, 518, 518, 518, 518, 518, 518, 518, 518, 518, 518, 518, 518, 518, 518, 518, 518, 518, 518, 518, 518, 518, 518, 518, 518, 518 },
        { 432, 752, 752, 432, 345, 705, 952, 528, 221,  54, 242, 237, 201, 162, 706, 728, 481, 590, 508, 480, 225,  62, 936, 796, 936, 340, 601, 340, 601, 934, 678, 786, 786, 786,  36,  36, 937, 786, 937, 786, 786, 937,  36,  36, 36,  36, 745, 532, 812, 119, 263, 934, 728, 618,  11, 592, 732, 752, 1000, 937, 653, 1022, 1016, 511,  92, 570, 239, 483, 662, 300, 154, 143, 389, 969, 573, 728, 915, 116, 851, 221, 353, 481, 481, 861, 242, 582, 918, 547, 326, 505, 221, 481, 137, 598, 769, 182,  45, 471, 327, 748, 759, 1023, 964, 1000, 981, 759, 879, 732, 1015, 832, 710, 829, 989,  36,  36, 786, 786, 937, 786, 786,  36, 36, 786, 937, 786, 786, 786, 786, 786, 937, 786, 786, 786, 786, 786, 786, 786, 786, 786, 786, 786, 786, 786, 786, 786, 786, 786, 786, 786, 786, 786, 786, 786, 786, 786, 786, 786, 786, 786, 786, 786, 786, 786, 786, 786, 786, 786, 786, 786, 786, 786 },
        { 1014, 762, 762, 1014, 398, 1019, 972, 878, 691,  31, 584, 801, 891, 277, 770, 845, 935, 317,  31, 376, 318, 766, 766, 403, 318, 940, 1014, 940, 212, 255, 762, 673, 673, 673, 673, 673, 673, 673, 673, 673, 673, 741, 741, 673, 741, 741, 980, 681, 853,  77, 945, 222,  85, 714, 726, 730, 793, 222, 222, 651, 673, 854, 780,  59, 776, 423, 944, 966, 716, 892, 374, 331, 406, 805, 756, 558, 1000, 326, 101, 171, 974, 388, 886, 294, 363,  12, 322, 255, 1000, 801, 615, 277, 855, 738, 771, 575, 993, 158, 974, 551, 921, 246, 770, 793, 704, 1019,  88, 962, 793, 830, 1019, 1022, 215, 741, 741, 673, 673, 673, 215, 673, 673, 673, 215, 673, 673, 673, 673, 673, 673, 673, 673, 673, 673, 673, 673, 673, 673, 673, 673, 673, 673, 673, 673, 673, 673, 673, 673, 673, 673, 673, 673, 673, 673, 673, 673, 673, 673, 673, 673, 673, 673, 673, 673, 673, 673, 673, 673, 673, 673, 673, 673 },
        { 222, 336, 373, 373, 236, 984, 134, 1020, 549, 939, 373, 687, 718, 687, 693, 1009, 430, 846, 379, 701, 653, 637, 236, 373, 379, 222, 373, 222, 907, 222, 373, 528, 528, 622, 622, 622, 448, 622, 448, 622, 622, 448, 448, 622, 448, 448, 515, 494, 452,  95, 596, 880, 915, 984, 632, 163, 373, 804, 983, 622, 448, 198, 884, 964,  96, 839, 707, 902, 912, 924, 562, 371, 210, 752, 247, 382, 804, 915, 920, 951, 404, 239, 487, 359, 685, 357, 958, 867, 267, 307, 611, 198, 169, 363, 342, 915, 189, 978, 338, 102, 487, 615, 691, 930, 413, 990, 884, 885, 885, 413, 528, 528, 622, 448, 448, 622, 622, 448, 622, 622, 622, 622, 448, 448, 622, 622, 622, 622, 622, 448, 622, 622, 622, 622, 622, 622, 622, 622, 622, 622, 622, 622, 622, 622, 622, 622, 622, 622, 622, 622, 622, 622, 622, 622, 622, 622, 622, 622, 622, 622, 622, 622, 622, 622, 622, 622, 622, 622, 622, 622, 622 },
        { 314, 293, 293, 975, 238,  96, 742,  5, 355, 381, 564, 1000,  57, 454, 506, 966, 168,  4,  96, 750,  79,  18, 96, 178, 632, 851, 632, 692,  96, 949, 763, 477, 435, 881, 986, 986, 939, 986, 939, 986, 986, 435, 881, 986, 939, 881,  90, 327, 813, 946, 441, 1022, 390, 561, 971, 963, 350, 692, 692, 632, 701,  42, 159, 975, 538, 772, 385, 784,  65, 247, 385, 706, 893, 675, 870, 597, 963, 196, 494,  20, 814, 219, 966, 373,  57,  96, 856, 389, 208, 936, 310, 248, 938,  95,  53,  53,  57,  53, 569, 650,  35, 793,  72, 650, 975, 390, 334, 683, 334, 881, 881, 939, 939, 632, 939, 986, 986, 435, 986, 986, 986, 986, 986, 939, 986, 986, 986, 986, 986, 939, 986, 986, 986, 986, 986, 986, 986, 986, 986, 986, 986, 986, 986, 986, 986, 986, 986, 986, 986, 986, 986, 986, 986, 986, 986, 986, 986, 986, 986, 986, 986, 986, 986, 986, 986, 986, 986, 986, 986, 986, 986 },
        { 365, 447, 879, 355, 665, 383, 648, 634, 114, 383, 744, 544, 953, 550, 697, 675, 583, 211, 238, 478, 681, 677, 1015, 665, 383, 485, 616, 585, 772, 383, 853, 853, 1002, 1002, 570, 570, 570, 1002, 570, 1002, 1002, 570, 900, 1002, 900, 900, 365,  16, 828, 516, 453, 114, 944, 291,  36, 626, 528, 772, 562, 900, 772, 516, 983, 525, 301,  54, 713, 888, 343, 398, 450, 264, 212, 471, 283, 495, 526, 783, 795, 711, 492, 695,  0, 622, 126, 983,  0, 826, 902, 731, 505, 927, 572, 723,  40, 649,  34, 735, 572, 579, 981, 936,  5, 560, 933, 409, 756, 364, 444, 764, 1002, 900, 570, 900, 900, 900, 900, 570, 1002, 1002, 1002, 570, 1002, 900, 900, 900, 900, 900, 900, 570, 900, 900, 900, 900, 900, 900, 900, 900, 900, 900, 900, 900, 900, 900, 900, 900, 900, 900, 900, 900, 900, 900, 900, 900, 900, 900, 900, 900, 900, 900, 900, 900, 900, 900, 900, 900, 900, 900, 900, 900, 900 },
        { 475, 237, 237, 467, 832, 469,  27, 916, 681, 1016, 654, 712, 412, 294, 724, 375, 516, 484,  14, 717, 410, 577, 528, 1019, 818, 237, 701, 583, 989, 948, 975, 518, 948, 518, 948, 948, 948, 975, 948, 948, 975, 948, 518, 975, 975, 518, 691, 602,  42,  36, 660,  12, 393, 977, 916, 101,  42, 410, 468, 975, 975, 149, 832, 978,  36, 853, 720, 406, 253, 754, 328, 556, 111, 638, 719, 558, 191, 551, 851, 720, 458, 458, 940, 194,  16, 194, 896, 654, 51, 625, 648,  55, 762, 651, 386, 580, 374, 613, 806, 711, 944, 806, 996, 947, 180, 383, 835, 947, 818, 237, 701, 899, 518, 518, 518, 975, 975, 948, 975, 948, 975, 948, 975, 518, 518, 518, 518, 518, 518, 518, 518, 518, 518, 518, 518, 518, 518, 518, 518, 518, 518, 518, 518, 518, 518, 518, 518, 518, 518, 518, 518, 518, 518, 518, 518, 518, 518, 518, 518, 518, 518, 518, 518, 518, 518, 518, 518, 518, 518, 518, 518 },
    };
    static const bark_codes ans3 = {
        { 871, 971, 871, 971, 871, 971, 971, 871, 971, 871, 971, 871, 971, 871, 635, 151, 533, 862, 415, 415, 862, 833, 1008, 881, 457, 942, 936, 751, 967, 879, 971, 347, 971, 871, 461, 940, 940, 151, 666, 800, 1018, 683, 912, 457, 833, 967, 1008, 501, 112, 923, 747, 747, 240, 690, 976, 347, 370, 370, 370, 934, 934, 934, 373, 373, 373, 373, 373, 373, 798, 935, 192, 233, 291, 192, 185, 679, 613, 613, 155, 901, 901, 901, 901, 598, 325, 904, 370, 904, 971, 370, 935, 496, 935, 666, 666, 982, 411, 59, 23, 23, 23, 604, 753, 370, 879, 91, 819, 798, 798, 798, 73, 91, 358, 11, 683, 901, 1022, 875, 321, 1001, 224, 1001, 982, 59, 151, 151, 1001, 151, 151, 151, 276, 208, 904, 904, 904, 904, 904, 904, 904, 276, 479, 59, 59, 59, 982, 982, 879, 699, 491, 151, 906, 151, 151, 598, 321, 699, 604, 604, 395, 904, 904, 904, 819, 887, 192, 59, 59, 59, 59, 59, 611 },
        { 969, 829, 969, 969, 969, 770, 666, 359, 969, 969, 969, 646, 969, 969, 71, 827, 185, 588, 878, 303, 987, 296, 666, 405, 373, 213, 729, 729, 729, 359, 729, 729, 729, 729, 164, 37, 144, 833, 770, 182, 212, 269, 228, 920, 564, 564, 199, 891, 891, 598, 36, 836, 959, 836, 633, 501, 687, 601, 857, 221, 633, 501, 747, 747, 747, 747, 747, 747, 752, 765, 947, 690, 955, 741, 406, 414, 654, 654, 907, 872, 654, 1002, 269, 632, 646, 877, 743, 829, 601, 404, 404, 857, 144, 501, 998, 767, 589, 924, 241, 439, 708, 877, 212, 765, 633, 928, 200, 404, 765, 601, 633, 404, 573, 175, 37, 800, 820, 897, 67, 693, 462, 520, 60, 176, 897, 578, 904, 458, 673, 596, 772, 772, 404, 71, 601, 601, 404, 404, 765, 928, 702, 283, 812, 560, 422, 63, 894, 71, 743, 229, 446, 998, 4, 904, 446, 772, 603, 829, 363, 404, 747, 601, 646, 404, 947, 178, 831, 831, 430, 793, 446 },
        { 551, 513, 513, 797, 861, 513, 1016, 70, 513, 513, 861, 832, 982, 179, 730, 675, 797, 94, 181, 859, 790, 790, 436, 122, 122, 932, 666, 878, 732, 967, 861, 878, 832, 732, 11, 967, 797, 94, 964, 562, 325, 475, 696, 601, 831, 797, 358, 154, 664, 357, 115, 143, 487, 422, 767, 832, 853, 551, 179, 165, 179, 551, 513, 551, 513, 513, 551, 832, 513, 551, 921, 435, 23, 495, 63, 250, 179, 311, 746, 250, 728, 771, 878, 23, 832, 551, 165, 513, 551, 458, 513, 486, 551, 893, 733, 465, 773, 493, 562, 957, 426, 551, 601, 513, 513, 179, 513, 551, 179, 513, 832, 601, 777, 673, 873, 550, 847, 551, 675, 898, 868, 436, 11, 589, 467, 14, 426, 308, 533, 533, 426, 912, 513, 880, 824, 513, 967, 513, 551, 1000, 901, 988, 988, 988, 604, 853, 426, 873, 796, 467, 549, 467, 945, 426, 675, 16, 880, 551, 551, 513, 829, 937, 513, 414, 757, 154, 623, 8, 623, 623, 910 },
        { 74, 88, 766, 960, 88, 278, 960, 960, 36, 388, 861, 780, 960, 36, 1012, 818, 810, 363, 243, 206, 828, 674, 618, 361, 599, 766, 305, 721, 714, 798, 286, 830, 999, 74, 200, 499, 1014, 600, 557, 497, 182, 414, 557, 823, 36, 739, 686, 743, 173, 216, 822, 822, 209, 835, 49, 739, 278, 780, 765, 88, 74, 203, 960, 261, 88, 789, 823, 88, 651, 915, 99, 242, 315, 1002, 699, 487, 426, 222, 9, 335, 569, 363, 222, 793, 960, 780, 88, 558, 960, 780, 874, 960, 88, 980, 261, 861, 261, 950, 177, 973, 960, 734, 793, 388, 528, 961, 766, 74, 749, 651, 528, 88, 302, 583, 792, 148, 865, 780, 88, 721, 364, 831, 773, 920, 457, 686, 951, 721, 224, 224, 369, 88, 721, 960, 288, 766, 960, 651, 278, 88, 853, 490, 960, 1012, 87, 640, 410, 830, 854, 999, 853, 618, 951, 951, 381, 88, 838, 961, 88, 1014, 960, 734, 766, 651, 644, 670, 392, 269, 116, 630, 855 },
        { 989, 648, 111, 989, 382, 983, 1007, 537, 804, 917, 646, 537, 930, 375, 1007, 382, 430, 954, 157, 579, 625, 864, 294, 984, 999, 515, 588, 45, 111, 884, 515, 844, 953, 111, 885, 185, 148, 125, 505, 586, 721, 930, 962, 930, 148, 989, 400, 60, 727, 962, 128, 514, 410, 742, 416, 382, 868, 111, 39, 983, 159, 930, 766, 804, 606, 967, 111, 989, 804, 944, 455, 102, 625, 637, 147, 145, 188, 633, 239, 324, 675, 109, 685, 537, 714, 714, 939, 990, 714, 416, 198, 903, 944, 844, 454, 903, 1006, 145, 142, 537, 628, 514, 680, 360, 904, 990, 111, 379, 885, 983, 537, 294, 757, 693, 337, 754, 958, 793, 459, 142, 382, 537, 809, 465, 142, 959, 145, 683, 188, 428, 428, 49, 983, 804, 912, 804, 990, 930, 111, 983, 966, 49, 935, 195, 363, 934, 947, 953, 683, 586, 444, 679, 860, 524, 446, 804, 652, 652, 222, 736, 606, 271, 885, 903, 993, 773, 154, 161, 251, 959, 540 },
        { 178, 885, 903, 373, 744, 946, 10, 640, 885, 10, 683, 502, 435, 632, 379, 611, 298, 502, 597, 807, 386, 801, 910, 625, 472, 499, 611, 315, 648, 597, 1011, 10, 604, 502, 9, 597, 730, 644, 150, 243, 593, 514, 549, 825, 505, 632, 744, 134, 360, 213, 253, 657, 468, 975, 851, 597, 975, 549, 10, 885, 1011, 995, 903, 1005, 692, 515, 903, 692, 477, 929, 903, 880, 843, 279, 802, 370, 413, 26, 136, 863, 931, 282, 988, 928, 502, 1022, 549, 19, 334, 1003, 701, 76, 863, 315, 502, 365, 24, 373, 146, 114, 348, 1005, 349, 95, 701, 1011, 450, 701, 314, 96, 885, 903, 1001, 843, 667, 476, 764, 781, 458, 502, 611, 801, 611, 578, 24, 802, 144, 529, 944, 816, 484, 274, 10, 781, 632, 995, 19, 929, 903, 10, 353, 336, 506, 312, 323, 944, 274, 597, 487, 450, 918, 923, 150, 519, 300, 885, 314, 16, 96, 692, 494, 692, 903, 293, 753, 602, 355, 592, 937, 568, 668 },
        { 562, 755, 243, 652, 874, 908, 485, 342, 1006, 786, 652, 365, 364, 364, 633, 1006, 845, 719, 493, 737, 694, 78, 110, 939, 677, 1008, 34, 887, 553, 786, 364, 292, 364, 936, 983, 998, 388, 786, 548, 721, 234, 693, 1017, 560, 994, 114, 729, 906, 191, 84, 153, 254, 283, 114, 628, 562, 406, 748, 977, 114, 408, 665, 693, 342, 860, 823, 243, 977, 41, 243, 925, 861, 586, 155, 444, 890, 24, 587, 856, 974, 1013, 944, 604, 90, 585, 552, 928, 243, 887, 994, 677, 556, 876, 552, 648, 439, 995, 186, 876, 439, 357, 876, 1015, 406, 876, 364, 364, 874, 364, 908, 261, 380, 710, 34, 466, 741, 794, 996, 778, 531, 186, 15, 936, 394, 408, 126, 716, 357, 30, 527, 1013, 219, 562, 944, 360, 782, 485, 764, 243, 380, 950, 863, 414, 689, 395, 45, 742, 874, 876, 406, 424, 0, 788, 626, 364, 905, 1015, 845, 444, 406, 994, 628, 291, 364, 444, 876, 824, 863, 470, 719, 957 },
        { 475, 808, 1019, 818, 639, 343, 989, 598, 343, 835, 828, 42, 818, 937, 468, 647, 280, 671, 434, 468, 268, 650, 926, 985, 273, 991, 496, 180, 639, 343, 309, 343, 472, 180, 267, 685, 468, 528, 583, 552, 226, 433, 57, 273, 429, 531, 936, 41, 690, 788, 225, 311, 485, 709, 343, 1018, 42, 516, 467, 628, 237, 1012, 835, 558, 559, 845, 233, 828, 639, 931, 12, 936, 118, 939, 682, 1016, 530, 801, 801, 732, 12, 484, 559, 567, 832, 818, 961, 670, 475, 410, 845, 336, 280, 225, 978, 630, 945, 267, 891, 1018, 393, 818, 343, 884, 559, 832, 989, 647, 813, 617, 315, 832, 822, 309, 967, 712, 714, 107, 233, 516, 173, 559, 43, 8, 625, 568, 472, 57, 1013, 813, 651, 194, 1019, 475, 647, 931, 559, 237, 647, 558, 855, 194, 884, 437, 504, 484, 832, 429, 828, 617, 922, 176, 194, 647, 309, 617, 828, 583, 835, 931, 237, 931, 628, 832, 583, 299, 707, 556, 962, 180, 491 },
    };

    static std::map<bark_codes, bark_codes> _k_tests = {
        { seq1, ans1 },  // hello world
    };
    return _k_tests;
};

int main(int argc, char** argv) {
    if (argc < 2) {
        fprintf(stderr, "Usage: %s <model-file>\n", argv[0]);
        return 1;
    }

    const std::string fname = argv[1];

    gpt_model model;
    std::mt19937 rng(0);

    const int   n_threads = 4;
    const float temp      = 0.0f;  // deterministic sampling

    printf("%s: reading bark coarse model\n", __func__);
    if(!gpt_model_load(fname, model)) {
        fprintf(stderr, "%s: invalid model file '%s'\n", __func__, fname.c_str());
        return 1;
    }

    for (const auto & test_kv : k_tests()) {
        bark_codes res = bark_forward_fine_encoder(
            test_kv.first, model, rng, n_threads, temp);

        bool correct = res.size() == test_kv.second.size();

        for (int i = 0; i < 3 && correct; ++i) {
            correct = res[i].size() == test_kv.second[i].size();
            for (int j = 0; j < (int) res[i].size() && correct; j++) {
                if (res[i][j] != test_kv.second[i][j]) {
                    correct = false;
                }
            }
        }

        if (!correct) {
            fprintf(stderr, "%s : failed test \n", __func__);
            fprintf(stderr, "%s : expected tokens (n=%zu): ", __func__, test_kv.second.size());
            for (int i = 0; i < 3; i++) {  // 2 because we can't visualize all codes
                for (int j = 0; j < (int) test_kv.second[i].size(); j++) {
                    if (test_kv.second[i][j] != res[i][j]) {
                        fprintf(stderr, "**%d** ", test_kv.second[i][j]);
                    } else {
                        fprintf(stderr, "%d ", test_kv.second[i][j]);
                    }
                }
                fprintf(stderr, "\n");
            }
            fprintf(stderr, "\n");
            fprintf(stderr, "%s : got tokens (n=%zu):      ", __func__, res.size());
            for (int i = 0; i < 3; i++) {  // 2 because we can't visualize all codes
                for (int j = 0; j < (int) res[i].size(); j++) {
                    fprintf(stderr, "%d ", res[i][j]);
                }
                fprintf(stderr, "\n");
            }
            fprintf(stderr, "\n");

            return 3;
        }
    }

    fprintf(stderr, "%s : tests passed successfully.\n", __func__);

    return 0;
}
